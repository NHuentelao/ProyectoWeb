
<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Registro - ReservaNoble</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" href="css/inicio.css">
    <script>
        // Check session status
        fetch('api/api.php?action=get_current_user_full')
          .then(response => {
            if (response.ok) {
              return response.json();
            }
            throw new Error('Not logged in');
          })
          .then(user => {
            if (user.rol === 'admin') {
              window.location.href = 'administrador.html';
            } else {
              window.location.href = 'formulario.html';
            }
          })
          .catch(() => {
            // Not logged in, stay here
            document.body.classList.remove('hidden-body');
          });
      </script>
      <style>
        .hidden-body { display: none; }
      </style>
</head>
<body class="hidden-body">

  <div class="page-layout" style="justify-content: center;">
	<div class="login-box" style="max-width: 480px;">
		<h2 style="color: var(--blue); text-align: center; margin-bottom: 24px;">Crear cuenta</h2>
		<form id="form" novalidate>
            <div class="input-group">
                <i class="fas fa-user input-icon"></i>
			    <input id="name" name="name" type="text" placeholder="Nombre completo" required>
            </div>

            <div class="input-group">
                <i class="fas fa-envelope input-icon"></i>
			    <input id="email" name="email" type="email" placeholder="Correo electrónico" required>
            </div>

            <div class="input-group">
                <i class="fas fa-lock input-icon"></i>
			    <input id="password" name="password" type="password" placeholder="Contraseña (min. 6 caracteres)" required minlength="6">
            </div>

            <div class="input-group">
                <i class="fas fa-lock input-icon"></i>
			    <input id="confirm" name="confirm" type="password" placeholder="Confirmar contraseña" required minlength="6">
            </div>

            <div class="input-group">
                <i class="fas fa-phone input-icon" style="z-index: 10;"></i>
                <div style="display: flex; align-items: center; width: 100%; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; background: rgba(0, 0, 0, 0.25); overflow: hidden;">
                    <span style="padding: 20px 10px 20px 56px; color: rgba(255, 255, 255, 0.8); font-weight: 500; border-right: 1px solid rgba(255, 255, 255, 0.1); background: rgba(255, 255, 255, 0.05); white-space: nowrap;">+56 9</span>
                    <input id="phone" name="phone" type="tel" placeholder="12345678" required maxlength="8" pattern="[0-9]{8}" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 8);" style="border: none; border-radius: 0; flex: 1; background: transparent; color: #ffffff; padding: 20px; margin: 0; width: auto; height: auto;">
                </div>
            </div>

			<button type="submit" class="btn primary" style="width: 100%; margin-top: 10px;">Registrarse</button>
			<div class="msg" id="msg" style="text-align: center; margin-top: 10px;">&nbsp;</div>
		</form>
		<p class="center-note" style="text-align: center; margin-top: 20px;">¿Ya tienes cuenta? <a href="index.html#login" style="color: var(--blue); font-weight: 600;">Iniciar sesión</a></p>
	</div>
  </div>

  <!-- Modal de Verificación de Correo -->
  <div id="verificationModal" class="modal hidden" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
    <div class="modal-content" style="background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 4px 20px rgba(0,0,0,0.2);">
        <h3 style="color: var(--blue); margin-bottom: 15px;">Verifica tu correo</h3>
        <p style="color: #666; margin-bottom: 20px;">Hemos enviado un código de 6 dígitos a tu correo electrónico. Ingrésalo para completar el registro.</p>
        
        <div class="input-group" style="margin-bottom: 20px;">
            <input id="verificationCode" type="text" placeholder="Código de 6 dígitos" maxlength="6" style="text-align: center; letter-spacing: 4px; font-size: 1.2rem; padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 6px;">
        </div>

        <button id="verifyBtn" class="btn primary" style="width: 100%;">Verificar</button>
        <button id="cancelVerifyBtn" class="btn secondary" style="width: 100%; margin-top: 10px; background: #f3f4f6; color: #333;">Cancelar</button>
        <div id="verifyMsg" class="msg" style="margin-top: 10px;"></div>
    </div>
  </div>

	<script src="js/registrar.js"></script>
</body>
</html>